---
permalink: esds/task_esds_configure_the_interface_config_files.html
sidebar: sidebar
keywords: solidfire esds, host network, networking
summary: Use the examples and tips provided to configure the host networking before you install SolidFire eSDS.
---
= Configure the host networking
:icons: font
:imagesdir: ../media/

[.lead]
Use the examples and tips provided to configure the host networking before you install SolidFire eSDS.

Here is a sample network configuration:

image::../media/esds_network_config_example.png[Shows a sample network configuration.]

In this example, two interfaces on the storage node are network https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/ch-configure_network_teaming#sec-Understanding_Network_Teaming[teamed^] and connected to the management network for redundancy purposes. Likewise, two additional interfaces are teamed and connected to the storage network.

NOTE: Each interface has a configuration file named ifcfg-<interface-name>X, where X is the number of the interface, starting with zero or 1 depending upon the naming convention used. The configuration files are created when you first create the interfaces. One configuration file should already exist for each of the two physical interfaces connected to the storage network. One configuration file should also exist for each of the two physical interfaces connected to the management network. The interface configuration files are placed in the /etc/sysconfig/network-scripts directory. See https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/getting_started_with_networkmanager[Interface configuration files^].

TIP: The examples provided here have the storage and management interface names for HPE servers. If you have a Dell server, the interface names are different. Storage interface names for the Dell server are em1 and em2. Management interface names for the Dell server are p3p1 and p3p2. 

.Steps

. Install `NetworkManager-dispatcher-routing-rules` package, and ensure that the appropriate repositories are configured.
. Configure your network switch using your switch vendor's documentation. For specific instructions about configuring Multi-chassis Link Aggregation Group (MLAG) protocol and Link Aggregation Control Protocol (LACP), see your switch vendor's documentation.
+
NOTE: It is recommended that you configure LACP fallback and disable LACP individual port suspension behavior by running `no lacp suspend-individual`. This enables the AccessPoint link to come up even without LACP packets being broadcast in case of misconfiguration.

. Edit the two configuration files for the physical interfaces connected to the storage network using the following example. Jumbo frame setting on the storage network is highly recommended, but not required. In this example below, the storage interface name is ens2f0 and the storage team name is team10G:
+
IMPORTANT: In all the example configurations listed here, NAME and DEVICE use the same values. You can use different values if you choose to do so.
+
----
# cat /etc/sysconfig/network-scripts/ifcfg-ens2f0
# 10G Team Physical Port to Storage Network
NAME=ens2f0
DEVICE=ens2f0
ONBOOT=yes
TEAM_MASTER=team10G
DEVICETYPE=TeamPort
MTU=9000
----

. Edit the two configuration files for the interfaces connected to the management network using the following example. In this example, the management interface name is eno5 and the management team name is team1G:
+
----
# cat ifcfg-eno5
# 1G Team Physical Port to Management Network
NAME=eno5
DEVICE=eno5
ONBOOT=yes
TEAM_MASTER=team1G
DEVICETYPE=TeamPort
----

. Create the team interface file for the storage team using the following example. In this example, the team is called team10G. It is on the storage network running the network teaming lacp runner.
+
NOTE: The active/active configuration is recommended for storage interfaces. This configuration requires extra active/active Multi-chassis Link Aggregation Group (MLAG) protocol and Link Aggregation Control Protocol (LACP) to be configured on the switches. This configuration requires the https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/sec-Understanding_the_Network_Teaming_Daemon_and_the_Runners[network teaming lacp runner^].
+
----
# cat /etc/sysconfig/network-scripts/ifcfg-team10G
# IPADDR= "SIP"
# GATEWAY= "SIP_GATEWAY"
# Pick one TEAM_CONFIG, activebackup or lacp
# note that lacp require changing switch port to lacp as well

TEAM_CONFIG="{\"runner\": {\"name\": \"lacp\"}, \"link_watch\": {\"name\": \"ethtool\"}}"
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=none
DEFROUTE=no
IPV4_FAILURE_FATAL=no
IPV6INIT=no
NAME=team10G
DEVICE=team10G
ONBOOT=yes
DEVICETYPE=Team
IPADDR=192.0.2.2
PREFIX=24
GATEWAY=192.0.2.1
NM_CONTROLLED=yes
MTU=9000
----

. Create the team interface file for the management team using the following example. In this example, the team is called team1G. It is on the management network running the network teaming activebackup runner.
+
NOTE: The active/passive configuration is recommended for management interfaces, though you can also use the active/active configuration. This does not require extra configurations on the leaf switches. This configuration uses the https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/networking_guide/sec-Understanding_the_Network_Teaming_Daemon_and_the_Runners[network teaming activebackup runner].
+
----
# cat /etc/sysconfig/network-scripts/ifcfg-team1G
# IPADDR= "MIP"
# GATEWAY= "MIP_GATEWAY"
# DNS1= "DNS"
# Pick one TEAM_CONFIG, activebackup or lacp
# note that lacp require changing switch port to lacp as well

TEAM_CONFIG="{\"runner\": {\"name\": \"activebackup\"}, \"link_watch\": {\"name\": \"ethtool\"}}"
#TEAM_CONFIG=”{ \”runner\”: {\”name\”: \”lacp\”, \”active\”: true, \”fast_rate\”: true }}”
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=none
DEFROUTE=yes
IPV4_FAILURE_FATAL=no
IPV6INIT=no
IPV6_AUTOCONF=yes
IPV6_DEFROUTE=yes
IPV6_FAILURE_FATAL=no
IPV6_ADDR_GEN_MODE=stable-privacy
NAME=team1G
DEVICE=team1G
ONBOOT=yes
DEVICETYPE=Team
IPADDR=198.51.100.2
PREFIX=24
GATEWAY=198.51.100.1
DNS1=198.51.100.250
NM_CONTROLLED=yes
----

. Edit the `/etc/iproute2/rt_tables` file to enable a new routing table using the following sample. This file defines the mappings to use the routing table names instead of index numbers to refer to a specific table. In the following example, the new storage routing table called team10G can be called by its index (20) or its name (team10G):
+
----
# cat /etc/iproute2/rt_tables
#
# reserved values
#
255local
254main
253default
0unspec

20   team10G
----

. Add routes to the routing table for storage traffic using the following example. This routing table points to the storage network as a default gateway and must be used for iSCSI traffic. In the following example, the teamed interface name is team10G.
+
NOTE: You should replace `$storage_network`, `$storage_if_name src`, `$SIP table`, `$routing_table_name`, `$storage_default_gw dev`, `$storage_if_name src`, `$SIP table`, and `$routing_table_name` with your own values.
+
----
# cat /etc/sysconfig/network-scripts/route-team10G
$storage_network/24 dev $storage_if_name src $SIP table $routing_table_name
default via $storage_default_gw dev $storage_if_name src $SIP table \
$routing_table_name
----

. Add policy-based routing to use the new routing table that you created, if the traffic originates from the SIP or SVIP. Use the following example and substitute with your own values:
+
----
# cat /etc/sysconfig/network-scripts/rule-team10G
from $SIP table
$routing_table_name
----

. Restart networking for all the changes to be applied.
+
----
# systemctl restart network.service
----

. To check the policy-based routing rules, run the `ip rule show` command.
. To check the routing table, run the `ip route show table` command.

== Find more information
* https://www.netapp.com/data-storage/solidfire/documentation/[NetApp SolidFire Resources Page^]
* https://docs.netapp.com/sfe-122/topic/com.netapp.ndc.sfe-vers/GUID-B1944B0E-B335-4E0B-B9F1-E960BF32AE56.html[Documentation for earlier versions of NetApp SolidFire and Element products^]
